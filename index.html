<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Item Hunt</title>
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Helvetica, sans-serif;
      background-color: whitesmoke;
    }
    .grid-container {
      display: grid;
      grid-gap: 16px;
      padding: 16px;
    }
    @media (max-width: 767px) {
      .grid-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (min-width: 768px) {
      .grid-container {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    .grid-item {
      border: 4px solid #f8f8f8;
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .grid-inner {
      margin: 4px;
      padding: 10px;
      border: 6px solid;
      border-radius: 16px;
    }
    .grid-inner img {
      width: 100%;
      display: block;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }
    .item-number,
    .status {
      font-weight: bold;
      font-size: 1.44em;
      margin: 5px 0;
    }
    .red-color {
      color: #DB4437;
    }
    .green-color {
      color: #0F9D58;
    }
  </style>
</head>
<body>
  <div class="grid-container" id="gridContainer"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCiN_rH3ekJXC_W7MU2xZ77Vu7CYrS6uYQ",
      authDomain: "item-hunt.firebaseapp.com",
      projectId: "item-hunt",
      storageBucket: "item-hunt.firebasestorage.app",
      messagingSenderId: "995765553615",
      appId: "1:995765553615:web:a253fff364374039bbeaba",
      measurementId: "G-5ER7MBLZZ7"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function calculateStatusText(dateFound) {
      const foundDate = new Date(dateFound);
      const today = new Date();
      foundDate.setHours(0,0,0,0);
      today.setHours(0,0,0,0);
      const diffTime = today - foundDate;
      const diffDays = diffTime / (1000 * 60 * 60 * 24);
      if (diffDays === 0) return "item found today";
      if (diffDays === 1) return "item found yesterday";
      return `item found ${diffDays} days ago`;
    }

    async function loadItems() {
      let itemsData = {};
      try {
        const snapshot = await db.collection("items").get();
        snapshot.forEach(doc => {
          itemsData[doc.id] = doc.data();
        });
      } catch (error) {
        console.error("Error fetching items:", error);
      }

      const container = document.getElementById('gridContainer');
      for (let i = 1; i <= 50; i++) {
        let code = ("000" + i).slice(-3);
        let data = itemsData[code] || { found: false };
        let found = data.found;
        let statusText = found && data.dateFound ? calculateStatusText(data.dateFound) : "item not found";

        const gridItem = document.createElement('div');
        gridItem.classList.add('grid-item');

        const gridInner = document.createElement('div');
        gridInner.classList.add('grid-inner');
        gridInner.style.borderColor = found ? '#0F9D58' : '#DB4437';

        const img = document.createElement('img');
        img.src = code + ".jpg";
        img.alt = `Item ${code}`;
        gridInner.appendChild(img);

        const infoDiv = document.createElement('div');
        infoDiv.classList.add('info');

        const numberDiv = document.createElement('div');
        numberDiv.classList.add('item-number');
        numberDiv.textContent = code;
        infoDiv.appendChild(numberDiv);

        const statusDiv = document.createElement('div');
        statusDiv.classList.add('status', found ? 'green-color' : 'red-color');
        statusDiv.textContent = statusText;
        infoDiv.appendChild(statusDiv);

        gridInner.appendChild(infoDiv);
        gridItem.appendChild(gridInner);
        container.appendChild(gridItem);
      }
    }

    loadItems();
  </script>
</body>
</html>
