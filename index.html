<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Item Hunt</title>
  <!-- Load Firebase App and Firestore libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore-compat.js"></script>
  <style>
    /* Basic styling */
    body {
      margin: 0;
      font-family: Helvetica, sans-serif;
      background-color: whitesmoke;
    }
    /* Container for grid items */
    .grid-container {
      display: grid;
      grid-gap: 16px;
      padding: 16px;
    }
    /* Responsive grid: 2 columns on small screens */
    @media (max-width: 767px) {
      .grid-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    /* Responsive grid: 5 columns on larger screens */
    @media (min-width: 768px) {
      .grid-container {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    /* Outer cell styling */
    .grid-item {
      border: 4px solid #f8f8f8; /* off-white */
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    /* Inner container with colored border indicating found status */
    .grid-inner {
      margin: 4px;
      padding: 10px;
      border: 6px solid; /* 6px thick border */
      border-radius: 16px;
    }
    /* Item image styling */
    .grid-inner img {
      width: 100%;
      display: block;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    /* Info bar for item number and status */
    .info {
      display: flex;
      justify-content: space-between; /* item number left, status right */
      align-items: center;
      margin-top: 10px;
    }
    .item-number,
    .status {
      font-weight: bold;
      /* Reduced text size: 0.8× of previous 1.8em = 1.44em */
      font-size: 1.44em;
      margin: 5px 0;
    }
    /* Colors for status */
    .red-color {
      color: #DB4437;
    }
    .green-color {
      color: #0F9D58;
    }
  </style>
</head>
<body>
  <!-- Grid container for the 30 items -->
  <div class="grid-container" id="gridContainer"></div>

  <script>
    // Full Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCiN_rH3ekJXC_W7MU2xZ77Vu7CYrS6uYQ",
      authDomain: "item-hunt.firebaseapp.com",
      projectId: "item-hunt",
      storageBucket: "item-hunt.firebasestorage.app",
      messagingSenderId: "995765553615",
      appId: "1:995765553615:web:a253fff364374039bbeaba",
      measurementId: "G-5ER7MBLZZ7"
    };

    // Initialize Firebase and Firestore.
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Helper function to compute status text from a date.
    function calculateStatusText(dateFound) {
      const foundDate = new Date(dateFound);
      const today = new Date();
      foundDate.setHours(0,0,0,0);
      today.setHours(0,0,0,0);
      const diffDays = (today - foundDate) / (1000 * 60 * 60 * 24);
      if (diffDays === 0) return "item found today";
      if (diffDays === 1) return "item found yesterday";
      return `item found ${diffDays} days ago`;
    }

    // Load the status of items from Firestore and display the grid.
    async function loadItems() {
      let itemsData = {};
      try {
        // Retrieve all documents from the "items" collection.
        const snapshot = await db.collection("items").get();
        snapshot.forEach(doc => {
          itemsData[doc.id] = doc.data();
        });
      } catch (error) {
        console.error("Error fetching items:", error);
      }

      const container = document.getElementById('gridContainer');
      // Loop from 1 to 30, using 2-digit numbers ("01", "02", …, "30")
      for (let i = 1; i <= 30; i++) {
        let code = ("00" + i).slice(-2);
        // If an item document isn’t found, assume it’s not been found.
        let data = itemsData[code] || { found: false };
        let found = data.found;
        let statusText = found && data.dateFound ? calculateStatusText(data.dateFound) : "item not found";

        // Create the outer grid cell.
        const gridItem = document.createElement('div');
        gridItem.classList.add('grid-item');

        // Create inner container with colored border.
        const gridInner = document.createElement('div');
        gridInner.classList.add('grid-inner');
        gridInner.style.borderColor = found ? '#0F9D58' : '#DB4437';

        // Create the image element. The image is expected at "[item code].jpg"
        const img = document.createElement('img');
        img.src = code + ".jpg";
        img.alt = `Item ${code}`;
        gridInner.appendChild(img);

        // Create the info bar for item number and status.
        const infoDiv = document.createElement('div');
        infoDiv.classList.add('info');

        // Left: item number.
        const numberDiv = document.createElement('div');
        numberDiv.classList.add('item-number');
        numberDiv.textContent = code;
        infoDiv.appendChild(numberDiv);

        // Right: status text.
        const statusDiv = document.createElement('div');
        statusDiv.classList.add('status', found ? 'green-color' : 'red-color');
        statusDiv.textContent = statusText;
        infoDiv.appendChild(statusDiv);

        // Assemble the cell.
        gridInner.appendChild(infoDiv);
        gridItem.appendChild(gridInner);
        container.appendChild(gridItem);
      }
    }

    // Load items on page load.
    loadItems();
  </script>
</body>
</html>
