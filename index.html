<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>University Scavenger Hunt</title>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #f7f7f7;
    }
    .grid-container {
      display: grid;
      grid-gap: 16px;
      padding: 16px;
    }
    /* Two columns on small screens */
    @media (max-width: 767px) {
      .grid-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    /* Five columns on larger screens */
    @media (min-width: 768px) {
      .grid-container {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    .grid-item {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      position: relative;
    }
    .grid-item img {
      width: 100%;
      display: block;
    }
    .info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      border-top: 2px solid; /* The color is set dynamically */
    }
    .item-number {
      font-weight: bold;
      color: #000;
    }
    .status {
      font-size: 0.9em;
    }
    .red-text {
      color: #DB4437;
    }
    .green-text {
      color: #0F9D58;
    }
  </style>
</head>
<body>
  <div class="grid-container" id="gridContainer">
    <!-- Grid items will be generated here -->
  </div>
  
  <script>
    // Replace these placeholders with your actual Firebase project config.
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      // ...other configuration variables as needed
    };

    // Initialize Firebase and Firestore.
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Calculate status text based on the dateFound
    function calculateStatusText(dateFound) {
      const foundDate = new Date(dateFound);
      const today = new Date();
      // Zero out the time for an accurate date difference.
      foundDate.setHours(0,0,0,0);
      today.setHours(0,0,0,0);
      const diffTime = today - foundDate;
      const diffDays = diffTime / (1000 * 60 * 60 * 24);
      if (diffDays === 0) {
        return "item found today";
      } else if (diffDays === 1) {
        return "item found yesterday";
      } else {
        return `item found ${diffDays} days ago`;
      }
    }

    async function loadItems() {
      // Create an object to hold data from Firestore.
      let itemsData = {};
      try {
        const snapshot = await db.collection("items").get();
        snapshot.forEach(doc => {
          itemsData[doc.id] = doc.data();
        });
      } catch (error) {
        console.error("Error fetching items:", error);
      }
      
      const container = document.getElementById('gridContainer');
      // Generate grid cells for item codes 001 to 100.
      for (let i = 1; i <= 100; i++) {
        let code = ("000" + i).slice(-3);
        // If there is no document, assume the item is not found.
        let data = itemsData[code] || { found: false };
        let found = data.found;
        let statusText = "item not found";
        if (found && data.dateFound) {
          statusText = calculateStatusText(data.dateFound);
        }
        
        // Create the grid cell.
        const div = document.createElement('div');
        div.classList.add('grid-item');
        
        // Create the image element (each image is named like "001.jpg").
        const img = document.createElement('img');
        img.src = code + ".jpg";
        img.alt = `Item ${code}`;
        div.appendChild(img);
        
        // Create the information bar.
        const infoDiv = document.createElement('div');
        infoDiv.classList.add('info');
        // Set border color: green if found, red if not.
        infoDiv.style.borderTopColor = found ? '#0F9D58' : '#DB4437';
        
        // Item number text.
        const numberDiv = document.createElement('div');
        numberDiv.classList.add('item-number');
        numberDiv.textContent = code;
        infoDiv.appendChild(numberDiv);
        
        // Status text.
        const statusDiv = document.createElement('div');
        statusDiv.classList.add('status');
        statusDiv.textContent = statusText;
        statusDiv.classList.add(found ? 'green-text' : 'red-text');
        infoDiv.appendChild(statusDiv);
        
        div.appendChild(infoDiv);
        container.appendChild(div);
      }
    }
    
    // Load all items once the page loads.
    loadItems();
  </script>
</body>
</html>
